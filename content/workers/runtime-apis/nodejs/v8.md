---
pcx_content_type: configuration
title: v8
---

# v8 Serialization/Deserialization

{{<render file="_nodejs-compat-howto.md">}}

Workers implements a subset of the Node.js [`v8`](https://nodejs.org/dist/latest-v20.x/docs/api/v8.html)
module that is used to serialize/deserialize JavaScript values using the same serialization format
used to implement the `structuredClone()` API.

## serialize/deserialize

The `serialize()` and `deserialize()` APIs in Node.js provide simple one-shot serialization and
deserialization of JavaScript values.

```js
import { serialize, deserialize } from 'node:v8';

const buffer = serialize({ foo: 'bar' });
const value = deserialize(buffer);
console.log(value.foo);  // Prints 'bar'
```

Refer to the [Node.js documentation for `serialize`](https://nodejs.org/dist/latest-v20.x/docs/api/v8.html#v8serializevalue) and [`deserialize`](https://nodejs.org/dist/latest-v20.x/docs/api/v8.html#v8deserializebuffer) for more information.

It is important to point out that the serialization format produced by these APIs are determined
entirely by the v8 implementation and are not part of any standard. As such, the format may change
over time and is not guaranteed to be forward compatible as new versions are released.

The serialized format produced by the `serialize()` method does include the serialization version
number, which the implementation will use to determine if the format is compatible with the current
implementation. An error will be thrown by `deserialize()` if the version number is not recognized
or supported.

## Serializer/Deserializer classes

The [`Serializer`](https://nodejs.org/dist/latest-v20.x/docs/api/v8.html#class-v8serializer) and
[`Deserializer`](https://nodejs.org/dist/latest-v20.x/docs/api/v8.html#class-v8deserializer) classes
provide a more flexible way to serialize and deserialize multiple values.

```js
import { Serializer, Deserializer } from 'node:v8';

const serializer = new Serializer();

// It is strongly recommended to always include the header when serializing
// so that the format version is included in the serialized result.
serializer.writeHeader();
serializer.writeValue({ foo: 'bar' });
serializer.writeUint32(42);
serializer.writeDouble(1.2);
const buffer = serializer.releaseBuffer();

const deserializer = new Deserializer(buffer);
deserializer.readHeader();
const value = deserializer.readValue();
const uint32 = deserializer.readUint32();
const double = deserializer.readDouble();
```

## DefaultSerializer/DefaultDeserializer classes

The [`DefaultSerializer`](https://nodejs.org/dist/latest-v20.x/docs/api/v8.html#class-v8defaultserializer)
and [`DefaultDeserializer`](https://nodejs.org/dist/latest-v20.x/docs/api/v8.html#class-v8defaultdeserializer)
classes are specializations of `Serializer` and `Deserializer` that handle `TypedArray` and `DataView`
objects as "host" objects, customizing the way they are serialized so that only the subset of the
underlying `ArrayBuffer` those reference are serialized and ensure that the Node.js `Buffer` class
is also properly handled.

```js
import { DefaultSerializer, DefaultDeserializer } from 'node:v8';
import { Buffer } from 'node:buffer';

const serializer = new DefaultSerializer();
serializer.writeHeader();
serializer.writeValue(Buffer.from('hello'));

const deserializer = new DefaultDeserializer(serializer.releaseBuffer());
deserializer.readHeader();
const buffer = deserializer.readValue();
console.log(buffer.toString());  // Prints 'hello'
```

## Serialization format version

It is important to understand that the serialized format produced by this API is not standardized
and can change over time from one version of v8 to the next. The format is designed to be backwards
compatible but not forwards compatible. It is important to always include the header when serializing
so that the format version is included in the serialized result, especially if the serialized data
is to be stored for later use or transmitted to a different process that may or may not be running
the same version of v8 under the hood.

As an extension to the Node.js API, Workers includes the ability to explicitly specify the serialization
format version to use when serializing/deserializing values. This is done by passing the `version`
option to any of the available APIs.

The minimum serialization format version supported by Workers is `13`.

```js
import {
  serialize,
  deserialize,
  Serializer,
  Deserializer,
} from 'node:v8';

const buffer = serialize({ foo: 'bar' }, { version: 15 });
const value = deserialize(buffer, { version: 15 });

// ...

const ser = new Serializer({ version: 15 });
// Calling writeHeader ensures that the format version is included
// in the serialized result.
ser.writeHeader();
// ...

const des = new Deserializer(ser.releaseBuffer(), { version: 15 });
// Calling readHeader consumes the format version from the serialized buffer.
ser.readHeader();
// ...
```
